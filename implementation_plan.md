# 안전교육 방탈출 웹게임 구현 계획 (Safety Escape Web Game Plan)

## 1. 프로젝트 개요 (Project Overview)
- **주제**: 초등학교 고학년 대상 화재 안전 교육 (과부하 콘센트 화재 시나리오)
- **장르**: Top-down 뷰 실시간 멀티플레이어 RPG/방탈출
- **인원**: 최대 4인 협동
- **기술 스택**:
  - **Frontend**: Phaser 3 (게임 엔진), HTML5, CSS3
  - **Backend**: Node.js (Express), Socket.io (실시간 통신)
  - **Build Tool**: Vite (빠른 개발 및 빌드 환경)

## 2. 디렉토리 구조 (Directory Structure)
```
safegame/
├── server/                 # 백엔드 관련 코드
│   ├── server.js           # 메인 서버 파일 (Socket.io 설정)
│   ├── rooms.js            # 방/플레이어 관리 로직
│   └── gameState.js        # 게임 상태 관리 (화재 발생 여부 등)
├── client/                 # 프론트엔드 (Phaser) 코드
│   ├── index.html
│   ├── src/
│   │   ├── main.js         # 게임 진입점 (Config)
│   │   ├── scenes/         # 게임 씬
│   │   │   ├── BootScene.js       # 리소스 로딩 전 설정
│   │   │   ├── PreloaderScene.js  # 에셋 로딩
│   │   │   ├── LobbyScene.js      # 대기실 (4명 매칭/준비)
│   │   │   ├── GameScene.js       # 실제 게임 플레이 (화재 시나리오)
│   │   │   └── UIScene.js         # UI 오버레이 (채팅, 상태바)
│   │   ├── objects/
│   │   │   ├── Player.js          # 플레이어 캐릭터 (이동, 애니메이션)
│   │   │   └── Interactable.js    # 상호작용 객체 (콘센트, 소화기)
│   │   └── utils/
│   │       └── socket.js          # 소켓 클라이언트 래퍼
│   └── public/
│       └── assets/         # 이미지, 타일맵, 사운드
├── package.json            # 프로젝트 의존성 관리
└── ...
```

## 3. 상세 구현 내용 (Detailed Implementation)

### A. 백엔드 (Node.js + Socket.io)
1.  **룸 시스템 (Room System)**:
    -   플레이어가 접속하면 대기 중인 방에 입장.
    -   방 당 최대 4명 제한.
    -   4명이 차거나 '준비'가 완료되면 게임 시작 이벤트 전송.
2.  **게임 상태 동기화 (State Sync)**:
    -   `players`: 각 플레이어의 위치(x, y), 방향, 동작 상태 저장.
    -   `objects`: 콘센트 상태(정상/과부하/화재), 소화기 위치 등.
    -   **주기적 업데이트**: 서버 틱(Tick)마다 변경된 상태를 클라이언트에 브로드캐스트 (최적화 필요).

### B. 프론트엔드 (Phaser 3)
1.  **맵 디자인**:
    -   Top-down 뷰의 거실 맵.
    -   충돌체(Walls, Furniture) 설정.
2.  **플레이어 (Player)**:
    -   키보드(방향키/WASD) 입력으로 이동.
    -   다른 플레이어의 움직임을 보간(Interpolation)하여 부드럽게 표시.
### B. 스토리 및 게임 루프 (Story & Game Loop)
**시나리오: "겨울방학, 우리들만의 아지트 위기일발!"**

1.  **인트로 (Intro - 30초)**:
    *   **상황**: 추운 겨울방학, 부모님이 잠깐 마트에 가신 사이 친구 4명이 거실에 모였습니다.
    *   **분위기**: 난방기구, 게임기, 스마트폰 충전기, TV 등 온갖 전자제품이 켜져 있어 따뜻하지만 어수선합니다.
    *   **사건 시작**: 갑자기 전등이 깜박거리고(Flicker), 어디선가 타는 냄새가 난다는 경고 메시지가 뜹니다. "어? 저 콘센트 좀 봐! 스파크가 튀고 있어!"

2.  **전개 1단계: 탐색 및 진단 (Investigation - 2분)**
    *   **미션**: "타는 냄새의 원인을 찾아라!"
    *   플레이어들은 4인 1조가 되어 거실, 주방, 안방으로 흩어져야 합니다.
    *   **위험 요소**: 맵 곳곳에 문어발식으로 연결된 멀티탭들이 숨겨져 있습니다(소파 뒤, 커튼 뒤 등).
    *   **협동 포인트**: 무거운 소파 뒤에 숨겨진 콘센트를 확인하려면 **2명이 같이** '들기' 버튼을 연타해야 합니다.

3.  **전개 2단계: 조치 및 해결 (Action - 2분)**
    *   **미션**: "과부하를 막아라!"
    *   단순히 코드를 뽑는 것이 아닙니다. 순서가 중요합니다.
    *   **퍼즐**: 전력을 많이 먹는 '전기히터'와 '헤어드라이어'를 먼저 끄고(OFF), 그 다음에 콘센트를 뽑아야 안전합니다. 
    *   순서를 틀리면 스파크가 튀어 플레이어가 잠시 기절(스턴)합니다. 친구가 와서 '깨워주기'를 해줘야 합니다.

4.  **위기 (Climax - 1분 - 실패 위기 시 발동)**
    *   **상황**: 제한 시간 내에 해결하지 못하면 결국 불이 붙습니다! (화면이 붉게 점멸, 사이렌 소리)
    *   **미션 변경**: "화재 발생! 진압하고 탈출하라!"
    *   **역할 분담**:
        *   **A 플레이어**: 119 신고 미션 (전화기 아이콘을 찾아 빠르게 번호 누르기/미니게임).
        *   **B 플레이어**: 소화기 찾아서 불 끄기 (화재 지점에 분사).
        *   **C, D 플레이어**: 젖은 수건(욕실)을 찾아 친구들에게 전달하고 현관문 장애물 치우기.

5.  **결말 (Ending)**
    *   **성공 (Best Ending)**: 화재를 예방했거나 초기 진압 완료. 부모님이 돌아오시고 "정말 대견하구나!" 칭찬. **'안전 보안관'** 뱃지 획득.
    *   **교육적 피드백**: 게임이 끝나면 방금 겪은 상황(문어발 배선의 위험성, 허용 전력량)에 대해 퀴즈 형식으로 짧게 복습합니다.

### C. 통신 프로토콜 (Socket Events)
-   `join_room`: 방 입장 요청
-   `current_players`: 현재 방의 플레이어 정보 수신
-   `new_player`: 새 플레이어 입장 알림
-   `player_moved`: 플레이어 이동 정보 전송/수신
-   `interact`: 상호작용 요청 (예: 콘센트 확인)
-   `object_update`: 오브젝트 상태 변경 (예: 불이 남)
-   `game_over`: 게임 결과 (성공/실패)

## 4. 개발 단계 (Development Steps)
1.  **환경 설정**: Node.js 프로젝트 init 및 Vite+Phaser 설치.
2.  **서버 기초**: Express + Socket.io 서버 가동.
3.  **클라이언트 기초**: Phaser 캔버스 띄우기 및 소켓 연결 확인.
4.  **멀티플레이어 이동**: 내 캐릭터 이동 및 상대방 캐릭터 동기화 구현.
5.  **맵 및 오브젝트 배치**: 타일맵 적용, 콘센트 등의 오브젝트 배치.
6.  **안전교육 로직 구현**:
    -   콘센트 과부하 로직.
    -   상호작용(뽑기/끄기) 구현.
7.  **UI 및 피드백**: 타이머, 성공/실패 메시지, 가이드 텍스트.

## 5. 예상 비주얼 스타일 (Aesthetics)
-   **캐릭터**: 초등학생 3~4등신 귀여운 픽셀/벡터 아트.
-   **환경**: 밝고 깔끔한 집 안 풍경 (위기 시 어둡고 붉은 톤으로 전환).
-   **UI**: 직관적이고 큰 버튼, 교육적인 팁 팝업.
